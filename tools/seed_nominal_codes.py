"""
Seed the nominal_code table with N/C codes and their object names.
These codes are used by the Other processor to map item descriptions to N/C codes using AI matching.
"""

import asyncio
import databases
import sqlalchemy

DATABASE_URL = "postgresql://bill_user:ayush23854@localhost/bill_processor_db"

# Complete Nominal codes list
# Format: (code, object_name)
NOMINAL_CODES = [
    ('0010', 'Freehold Property'),
    ('0011', 'Freehold Prop Depreciation'),
    ('0012', 'Leasehold Property'),
    ('0013', 'Leasehold Prop Depreciation'),
    ('0014', 'Property'),
    ('0015', 'Depreciation'),
    ('0020', 'Plant and Machinery'),
    ('0021', 'Plant/Machinery Depreciation'),
    ('0030', 'Office Equipment'),
    ('0031', 'Office Equipment Depreciation'),
    ('0040', 'Furniture and Fixtures'),
    ('0041', 'Furniture/Fixture Depreciation'),
    ('0050', 'Motor Vehicles'),
    ('0051', 'Motor Vehicles Depreciation'),
    ('0055', 'Investment - Dearnside Motor Co'),
    ('0056', 'Investment in joint venture - PAIL'),
    ('0057', 'Investment in subsidiary'),
    ('0058', 'Investment- JBros (Investments) Ltd.'),
    ('0060', 'Others'),
    ('0061', 'Others Depreciation'),
    ('0062', 'Intangible Assets'),
    ('0063', 'intangible Assets Depreciation-(sathees)'),
    ('0064', 'Improvement of Assets'),
    ('0065', 'Improvement of Assets- Accumulated Depreciation'),
    ('0070', 'Delph & Saxon Prelim'),
    ('0080', 'Professional Fees (Capitalization)'),
    ('0081', 'Professional Fees (Depreciation)'),
    ('1001', 'Stock'),
    ('1002', 'Work in Progress'),
    ('1003', 'Finished Goods'),
    ('1004', 'Raw Materials'),
    ('1100', 'Debtors Control Account'),
    ('1101', 'Sundry Debtors'),
    ('1102', 'Other Debtors'),
    ('1103', 'Prepayments'),
    ('1104', 'Inter-company Debtors'),
    ('1105', 'PRL Platinum Retail Limited'),
    ('1106', 'Provision for doubtful debts'),
    ('1107', 'Loan Account : Operators'),
    ('1108', 'Others debtors-Difference in DRS And PSR'),
    ('1109', 'Certas Energy - Cash Bond'),
    ('1110', 'DRS Commissions-Rhina Sutton - Loan Advance'),
    ('1111', 'Penlan Account'),
    ('1112', 'Edmonton Service station'),
    ('1113', 'Dearnside Motor Company LTD-Intercompany'),
    ('1114', 'HKS Retail Limited'),
    ('1115', 'Site Local Account'),
    ('1116', 'Fuelstop-InterCompany'),
    ('1117', 'Linvick Ltd-Intercompany'),
    ('1118', 'Snakeslane roundwood station'),
    ('1119', 'M SRITHARAN SEJ'),
    ('1120', 'FORMCRAFT LIMITED SEJ'),
    ('1121', 'Swan'),
    ('1122', 'ELLAND -Inter Company'),
    ('1123', 'Rainbow Service Station-Intercompany'),
    ('1124', 'Haresfinch'),
    ('1125', 'W M KALIM SEJ'),
    ('1126', 'BENTLEY SSTN'),
    ('1127', 'Delph service station-Shop'),
    ('1128', 'Saxon Operator (Shop)'),
    ('1129', 'Jamie Loan Account'),
    ('1130', 'Jubits Service Station - Shop(sathees)'),
    ('1131', 'West End Service Station - Shop(sathees)'),
    ('1132', 'V S SERVICES LOAN  SEJ'),
    ('1133', 'Autopitstop Operator'),
    ('1134', 'Crankhall Lane Service station'),
    ('1135', 'Jubits Lane-from 25.09.2019'),
    ('1136', '(Not in use)West End- From 25.09.2019'),
    ('1137', 'Jubits-New Operator(after 11.11.2019)'),
    ('1138', 'West-New Operator(after  11.11.2019)'),
    ('1139', 'R\'oLeary(Furnival)-Intercompany'),
    ('1140', 'RYAN'),
    ('1141', 'Fuel Efficient'),
    ('1142', 'Trustees of the Motor Fuel Limited Directors Pension Scheme'),
    ('1143', 'JBROS (Investments) Ltd-Intercompany'),
    ('1144', '303 PRESTON ROAD LIMITED'),
    ('1145', 'JOHN CORBO'),
    ('1146', 'SLOANPLUMB WOOD'),
    ('1147', 'LOAN-Dummy Code'),
    ('1148', 'White Rose Service Station-Intercompany'),
    ('1149', 'NEXA-matthew'),
    ('1150', 'NEXA-MFG-10351'),
    ('1151', 'NEXA- MI/12239-New facilities with Lloyds Bank plc'),
    ('1152', 'NEXA-CLOSED'),
    ('1153', 'NEXA-Matter: MI/8186'),
    ('1154', 'NEXA-8187(Loans to Easy Property Group Limited and The Easy'),
    ('1155', 'NEXA-8651(Miscellaneous matters)'),
    ('1156', 'NOT IN USE'),
    ('1157', 'NEXA-MI/14080-(90 Sedgley Limited (Kings Garage)'),
    ('1158', 'NEXA-MI/12344-Artorius: Station Rd, Gnosall and Minsterley,'),
    ('1159', 'NEXA-MI/8635-(Springbank Garage, Nelson: acquisition)'),
    ('1160', 'NEXA-MI/15327-Esso PFS and former Volvo, Reckleford, Yeovil'),
    ('1161', 'NEXA-MI/16854-Kegworth Service Station'),
    ('1162', 'NEXA-MI/16857-Canklow Service Station'),
    ('1163', 'NEXA-MI/18621-Harvest (Doncaster), Portway (Milton),West'),
    ('1164', 'NEXA-MI/23186-Vale Service Station, Ashton under Hill, Evesh'),
    ('1165', 'NEXA-MI/22587-guyhirn - lease of old cafe part of site'),
    ('1166', 'NEXA-MI/8053'),
    ('1167', 'NEXA-Matter: MI/8181'),
    ('1168', 'NEXA-MI/27187-Stanton Service Station'),
    ('1169', 'NEXA-MI/24324'),
    ('1170', 'NEXA-MI/27925'),
    ('1198', 'Unidentified Payment'),
    ('1200', 'PRL (HSBC A/C 02739186)'),
    ('1205', 'Penlan (HSBC A/C 42802937)'),
    ('1210', 'Lanner Moor (HSBC A/C 42802929)'),
    ('1215', 'Edmonton Service ( HSBC A/C 84370023)'),
    ('1220', 'Luton Connect (HSBC 04435427)'),
    ('1223', 'EDMONTON A/C  50110515'),
    ('1224', 'Lloyds Bank( 34969060)'),
    ('1225', 'PRL (HSBC A/C 02739194)'),
    ('1226', 'Hen & Chicken - HSBC A/c 74400046'),
    ('1230', 'Petty Cash'),
    ('1231', 'Manor A/C 80110485'),
    ('1232', 'Float Money'),
    ('1234', 'Luton (HSBC A/C 50110523)'),
    ('1235', 'Hen & Chicken ( HSBC A/c  50110507'),
    ('1236', 'Commercial Mortgage ( HSBC A/c 90458031)'),
    ('1237', 'Other Deposits'),
    ('1240', 'Company Credit Card'),
    ('1245', 'Shell Kempston ( A/c 24542517)'),
    ('1246', 'Shell Kempston ( A/C 80110477)'),
    ('1249', 'DEPOSITS (Refundable)'),
    ('1250', 'Manor Connect (HSBC A/C 04435435)'),
    ('1255', 'Kings Lane ( HSBC A/c 83832090 )'),
    ('1260', 'Shell St. Christopher ( A/c 04542495)'),
    ('1261', 'Christopher A/C 80110493'),
    ('1265', 'KLSS Bank Loan ( HSBC  A/c 80042803 )'),
    ('1266', 'Mortgage (Hsbc A/c-91107496)'),
    ('1270', 'Dearnside Motor'),
    ('1275', 'Kegworth(HSBC A/C 43839052)'),
    ('1276', 'Lloyds Loan A'),
    ('1277', 'Lloyds Loan B'),
    ('1278', 'PRL Lloyd Loan A/c:L2002600323'),
    ('1279', 'MFG -HSBC Loan (Facility B)'),
    ('1280', 'Lloyds -Jubit Lane(35223068)'),
    ('1281', 'Lloyds  Worsley Brow(35217068)'),
    ('1282', 'Lloyds -West End Road(35454360)'),
    ('1283', 'Lloyds  Haresfinch(35222668)'),
    ('1284', 'Lloyds - PRL A/c 34969060'),
    ('1285', 'LLoyds : PRL (A/c 145643 Dearnside )'),
    ('1286', 'DUMMY BANK'),
    ('1287', 'PRL(00357748)-Lloyds bank'),
    ('1288', 'Loan SAL A/c-00546941'),
    ('1289', 'Haresfich (A/C No.38807660)'),
    ('1290', 'PRL Lloyds Loan A/c:01630413'),
    ('1291', 'PRL Lloyds Loan A/c:01635113'),
    ('1292', 'Loan A/c :40116071218719(HSBC)'),
    ('1293', 'Lloyds Bank-Dearnside A/c-35280668'),
    ('1294', 'HSBC Loan A/C-54040368'),
    ('1295', 'HSBC Loan (Facility A)'),
    ('1296', 'new loan-matthew'),
    ('1297', 'BP Loan'),
    ('1298', 'PRL Lloyd Loan A/c:L2002561514'),
    ('1299', 'PRL Lloyd Loan A/c:L2002600323'),
    ('1300', 'Cash'),
    ('1301', 'VISA SWITCH'),
    ('1302', 'BP'),
    ('1303', 'Shell'),
    ('1304', 'Allstar'),
    ('1305', 'Amex'),
    ('1306', 'Texaco'),
    ('1307', 'OTHERS'),
    ('1308', 'Local Accounts'),
    ('1309', ''),
    ('2100', 'Creditors Control Account'),
    ('2101', 'Sundry Creditors'),
    ('2102', 'Other Creditors'),
    ('2103', 'Blake Morgan'),
    ('2104', 'Nexa-Loan Closer'),
    ('2105', 'Dearnsdie Motor Co.'),
    ('2106', 'MI-10777-Ptarmigan Holdings Ltd'),
    ('2107', 'BP Dealer Loan'),
    ('2108', 'Unidentified Receipt'),
    ('2109', 'Accruals'),
    ('2200', 'Sales Tax Control Account'),
    ('2201', 'Purchase Tax Control Account'),
    ('2202', 'VAT Liability'),
    ('2204', 'Manual Adjustments'),
    ('2205', 'Union OSS Tax Control Account'),
    ('2206', 'Non-union OSS Tax Control Account'),
    ('2207', 'IOSS Tax Control Account'),
    ('2210', 'P.A.Y.E.'),
    ('2211', 'National Insurance'),
    ('2220', 'Net Wages'),
    ('2230', 'Pension Fund'),
    ('2300', 'Loans realted to directors'),
    ('2301', 'Directors Loan Accounts (Director 1)'),
    ('2302', 'Directors Loan Accounts (Director 2)'),
    ('2303', 'Directors Loan Account (Linda)'),
    ('2310', 'Opening Trial Balance'),
    ('2320', 'Corporation Tax'),
    ('2321', 'Deferred tax liability'),
    ('2330', 'Mortgages'),
    ('3000', 'Ordinary Shares'),
    ('3001', 'Share Premium'),
    ('3010', 'Preference Shares'),
    ('3100', 'Revaluation Reserves'),
    ('3101', 'Undistributed Reserves'),
    ('3200', 'Profit and Loss Account'),
    ('4000', 'Petrol-Sales'),
    ('4001', 'Diesel-Sales'),
    ('4002', 'Super Petrol-Sales'),
    ('4003', 'Super Diesel-Sales'),
    ('4004', 'Sales : Edmonton Service Sation'),
    ('4005', 'Sales : Penlan Service Station'),
    ('4006', 'Sales - Shop Floor'),
    ('4007', 'Sales : Car Wash'),
    ('4008', 'AdBlue-Sales'),
    ('4009', 'Discounts Allowed'),
    ('4010', 'National Lottery'),
    ('4011', 'Paypoint'),
    ('4012', 'Texaco - UK Fuels'),
    ('4013', 'Costa Sales'),
    ('4014', 'LPG-Sales'),
    ('4099', 'unused'),
    ('4100', 'Penlan Account'),
    ('4101', 'Edmonton Service Station Account'),
    ('4200', 'Sales of Assets'),
    ('4400', 'Bunkering Charges'),
    ('4900', 'Operating Fees'),
    ('4901', 'ATM Machine Income'),
    ('4902', 'Commissions Received'),
    ('4903', 'Insurance Claims'),
    ('4904', 'Rent Income'),
    ('4905', 'Daily Facility Fees'),
    ('4906', 'Bank Deposit Interest Received'),
    ('4907', 'Sundry Income'),
    ('4908', 'Other Interest received'),
    ('5000', 'Petrol-Purchases'),
    ('5001', 'Diesel-Purchases'),
    ('5002', 'Miscellaneous Purchases'),
    ('5003', 'Super Petrol-Purchases'),
    ('5004', 'Super Diesel-Purchases'),
    ('5005', 'Purchases : Shop Floor'),
    ('5006', 'National Lottery'),
    ('5007', 'Car Wash Material-Purchases'),
    ('5008', 'Stock from Operators-Purchases'),
    ('5009', 'Service Pumps'),
    ('5010', 'Costa Purchase'),
    ('5011', 'Liquid Petrolium Gas'),
    ('5012', 'EPAY/PAYPOINT'),
    ('5013', 'Margin Share'),
    ('5014', 'AdBlue-Purchases'),
    ('5015', 'LPG-Purcahase'),
    ('5100', 'Health & Safety - Audit and Risk Assessment'),
    ('5101', 'Polling Fee (not to use)'),
    ('5102', 'Other Purchases-(Fuel Promotional)'),
    ('5103', 'Agency Charges'),
    ('5104', 'Fuel Promotional'),
    ('5105', 'Credit Card Charges'),
    ('5200', 'Stock Movement'),
    ('5201', 'Closing Stock'),
    ('5202', 'Purchase of Stock - 4 Sites in St Helens'),
    ('6000', 'Productive Labour'),
    ('6001', 'Cost of Sales Labour'),
    ('6002', 'Sub-Contractors'),
    ('6100', 'Fuel Commissions'),
    ('6101', 'Daily Facility Fees'),
    ('6102', 'Valeting Facility Commissions'),
    ('6200', 'Sales Promotions'),
    ('6201', 'Marketing & Advertising'),
    ('6202', 'Gifts and Samples'),
    ('6203', 'P.R. (Literature & Brochures)'),
    ('6204', 'Site Operator Fees'),
    ('6205', 'Vouchers'),
    ('6900', 'Miscellaneous Expenses'),
    ('7000', 'Gross Wages'),
    ('7001', 'Bonus'),
    ('7002', 'Directors Remuneration'),
    ('7003', 'Staff Salaries - Luton'),
    ('7004', 'Wages - Regular'),
    ('7005', 'Wages - Casual'),
    ('7006', 'Employers N.I. (Non-Directors)'),
    ('7007', 'Staff Pensions Costs'),
    ('7008', 'Recruitment Expenses'),
    ('7009', 'Adjustments'),
    ('7010', 'SSP Reclaimed'),
    ('7011', 'SMP Reclaimed'),
    ('7012', 'Employers N.I. (Directors)'),
    ('7099', 'Marketing & Advertisement'),
    ('7100', 'Rent'),
    ('7102', 'Water Rates'),
    ('7103', 'General Rates'),
    ('7104', 'Premises Insurance'),
    ('7200', 'Electricity'),
    ('7201', 'Gas'),
    ('7202', 'Oil'),
    ('7203', 'Other Heating Costs'),
    ('7300', 'Vehicle Fuel'),
    ('7301', 'Vehicle Repairs and Servicing'),
    ('7302', 'Vehicle Hire'),
    ('7303', 'Vehicle Insurance'),
    ('7304', 'Motor Vehicle Rental Expenses'),
    ('7305', 'Congestion Charges'),
    ('7306', 'Mileage Claims+Insurance'),
    ('7350', 'Scale Charges'),
    ('7400', 'Travelling'),
    ('7401', 'Car Hire'),
    ('7402', 'Hotels'),
    ('7403', 'U.K. Entertainment'),
    ('7404', 'Overseas Entertainment'),
    ('7405', 'Overseas Travelling'),
    ('7406', 'Subsistence'),
    ('7500', 'Printing'),
    ('7501', 'Postage and Carriage'),
    ('7502', 'Office Stationery'),
    ('7503', 'Computer Expenses'),
    ('7505', 'Freight Charges'),
    ('7550', 'Telephone and Fax'),
    ('7551', 'Internet Charges'),
    ('7552', 'Computers & Software'),
    ('7553', 'Mobile Charges'),
    ('7600', 'Legal Fees'),
    ('7601', 'Audit Fees'),
    ('7602', 'Accountancy Fees'),
    ('7603', 'Consultancy Fees'),
    ('7604', 'Professional Fees'),
    ('7605', 'Management Charges Payable'),
    ('7606', 'Software Subscriptions'),
    ('7607', 'Royalty Fee'),
    ('7700', 'Equipment Hire'),
    ('7701', 'Office Machine Maintenance'),
    ('7702', 'Equipment Leasing, Repair and Hire'),
    ('7703', 'Leasing'),
    ('7752', 'Arrangement Fees'),
    ('7800', 'Burglar Alarm - Security/Fire protection'),
    ('7801', 'Repairs and Renewals'),
    ('7802', 'Cleaning Expenses'),
    ('7803', 'Premises Expenses'),
    ('7804', 'Penalty Charges'),
    ('7900', 'Bank Interest Paid'),
    ('7901', 'Bank Charges'),
    ('7902', 'Currency Charges'),
    ('7903', 'Loan Interest Paid'),
    ('7904', 'H.P. Interest'),
    ('7905', 'Credit Charges (inc Polling)'),
    ('7906', 'Exchange Rate Variance'),
    ('7907', 'Other Interest Charges'),
    ('7908', 'Factoring Charges'),
    ('7909', 'Black Morgan'),
    ('7980', 'Delph & Saxon Prelim W/O'),
    ('8000', 'Depreciation'),
    ('8001', 'Plant/Machinery Depreciation'),
    ('8002', 'Furniture/Fitting Depreciation'),
    ('8003', 'Vehicle Depreciation'),
    ('8004', 'Office Equipment Depreciation'),
    ('8005', 'Others Depreciation'),
    ('8006', 'Property Depreciation'),
    ('8007', 'Intangible Assets Depreciation'),
    ('8008', 'Improvement of Assets- Depreciation'),
    ('8009', 'Professional Fees-Amortisation'),
    ('8100', 'Bad Debt Write Off'),
    ('8102', 'Bad Debt Provision'),
    ('8200', 'Donations'),
    ('8201', 'Subscriptions & Licences'),
    ('8202', 'Clothing Costs'),
    ('8203', 'Training Costs'),
    ('8204', 'Insurance'),
    ('8205', 'Refreshments'),
    ('8206', 'Cash Register Discrepancies'),
    ('8207', 'Site Consumables'),
    ('8208', 'Staff Expenses'),
    ('8209', 'BPME'),
    ('8245', 'Premises Insurance'),
    ('8250', 'Sundry Expenses'),
    ('8251', 'P/L on Sale/Disposal of Asst'),
    ('9000', 'Deferred tax'),
    ('9001', 'Taxation'),
    ('9996', 'Daily Cash POsting Suspense'),
    ('9997', 'Daily Cash Posting control'),
    ('9998', 'misposting supplier'),
    ('9999', 'Mispostings Customer'),
]

async def seed_nominal_codes():
    """Seed the nominal_code table"""
    database = databases.Database(DATABASE_URL)
    
    try:
        await database.connect()
        print("Connected to database")
        
        # Clear existing data
        await database.execute("DELETE FROM nominal_code")
        print("Cleared existing nominal codes")
        
        # Insert nominal codes
        inserted = 0
        for code, object_name in NOMINAL_CODES:
            try:
                if object_name.strip():  # Skip empty names
                    await database.execute(
                        "INSERT INTO nominal_code (code, object_name) VALUES (:code, :object_name)",
                        {"code": code, "object_name": object_name}
                    )
                    inserted += 1
            except Exception as e:
                print(f"Error inserting {code}: {e}")
        
        print(f"\n✅ Successfully seeded {inserted} nominal codes")
        
        # Verify
        result = await database.fetch_all("SELECT * FROM nominal_code ORDER BY code")
        print(f"✓ Total nominal codes in database: {len(result)}")
        
        # Show first few for verification
        print("\nFirst 5 codes:")
        for row in result[:5]:
            print(f"  {row['code']}: {row['object_name']}")
        
        print("\nLast 5 codes:")
        for row in result[-5:]:
            print(f"  {row['code']}: {row['object_name']}")
        
        await database.disconnect()
        
    except Exception as e:
        print(f"❌ Error: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    asyncio.run(seed_nominal_codes())
